{"id":"hook-comms-0ib","content_hash":"7d14bd19077f7d968d747064480217ccb1022c3d65f617dfd885e484f60f1601","title":"Test issue daemon mode","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-08T05:33:55.048465Z","updated_at":"2025-11-08T05:33:55.048465Z"}
{"id":"hook-comms-0wm","content_hash":"56cd3bdd2fda8b133b73851a449aed3f5d8c7a7b2cbc787005870a5678d99efd","title":"Phase 6: Verify TUI compatibility","description":"Verify ui/tui.py and ui/manage.py work with DB backend (no code changes expected). See docs/plans/instance-db-migration.md Phase 6 (lines 1064-1070).","design":"TUI uses load_all_positions() abstraction which now queries DB. Should work without changes. Manual verification needed.","acceptance_criteria":"- [ ] TUI launches without errors\n- [ ] Instance list displays correctly\n- [ ] Status updates work\n- [ ] No INSTANCES_DIR references in UI code","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-08T06:43:38.126509Z","updated_at":"2025-11-08T06:43:38.126509Z","dependencies":[{"issue_id":"hook-comms-0wm","depends_on_id":"hook-comms-87f","type":"parent-child","created_at":"2025-11-08T06:47:07.888053Z","created_by":"daemon"}]}
{"id":"hook-comms-2rh","content_hash":"ef9cbe3db40d5d5868abb6f5aded46d5360c98631e27867264aeb754f454a79d","title":"Phase 8: Delete filesystem references","description":"Delete INSTANCES_DIR constant, get_instance_file(), all glob operations. Update dispatcher.py to use DB queries. See docs/plans/instance-db-migration.md Phase 8 (lines 1167-1232).","design":"Delete INSTANCES_DIR from paths.py. Delete get_instance_file() from instances.py. Fix dispatcher.py:38 instance check to use get_instance(). Remove all glob('*.json') operations.","acceptance_criteria":"- [ ] INSTANCES_DIR constant deleted from paths.py\n- [ ] get_instance_file() deleted\n- [ ] dispatcher.py uses DB query for instance check\n- [ ] No glob operations remain in codebase\n- [ ] DB is single source of truth","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-08T06:43:47.214063Z","updated_at":"2025-11-08T06:43:47.214063Z","dependencies":[{"issue_id":"hook-comms-2rh","depends_on_id":"hook-comms-8z7","type":"blocks","created_at":"2025-11-08T06:46:57.357071Z","created_by":"daemon"},{"issue_id":"hook-comms-2rh","depends_on_id":"hook-comms-87f","type":"parent-child","created_at":"2025-11-08T06:47:08.213897Z","created_by":"daemon"}]}
{"id":"hook-comms-3tk","content_hash":"034d18502eebb541de2875e47fcd12f0de73e81fff536aa9ea24f0315789ddad","title":"Phase 3: Update hook handlers in handlers.py","description":"Rewrite subagent creation to use DB INSERT (not file.touch). Fix orphan cleanup to use name prefix queries. See docs/plans/instance-db-migration.md Phase 3 (lines 851-886).","design":"Replace file.touch(exist_ok=False) collision detection with DB INSERT + IntegrityError handling. Subagent placeholder uses session_id=NULL (not empty string). Cleanup query: WHERE name LIKE 'parent_%' (not parent_session_id FK - breaks for vanilla).","acceptance_criteria":"- [ ] Subagent creation uses DB INSERT (lines 98-116)\n- [ ] IntegrityError handling for name collisions\n- [ ] Placeholder subagents use session_id=NULL\n- [ ] _cleanup_orphaned_subagents uses name prefix query\n- [ ] Works for both vanilla + HCOM-launched instances","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-08T06:43:24.391689Z","updated_at":"2025-11-08T06:43:24.391689Z","dependencies":[{"issue_id":"hook-comms-3tk","depends_on_id":"hook-comms-v0m","type":"blocks","created_at":"2025-11-08T06:46:56.896235Z","created_by":"daemon"},{"issue_id":"hook-comms-3tk","depends_on_id":"hook-comms-87f","type":"parent-child","created_at":"2025-11-08T06:47:07.444065Z","created_by":"daemon"}]}
{"id":"hook-comms-5qc","content_hash":"63583a08d848238c35d811b624d6e755910c582b68ed32ed2f3ee21ab745fd59","title":"Phase 2: Update Message Operations","description":"Replace file-based message operations with SQLite queries in src/hcom/core/messages.py. Update send_message() to INSERT events, get_unread_messages() to SELECT with filtering, get_subagent_messages() to query by parent name.","design":"send_message(): Extract @mentions, log_event('message', ...), notify instances. get_unread_messages(): Query events WHERE id \u003e last_event_id, apply should_deliver_message filtering, return (messages, max_event_id) tuple. get_subagent_messages(): Query all messages, filter by parent name prefix, return (messages, last_event_id, per_subagent_counts). Remove parse_log_messages(), LogParseResult class, get_position_for_timestamp().","acceptance_criteria":"- [ ] send_message() inserts to SQLite not file\n- [ ] get_unread_messages() returns tuple (messages, event_id)\n- [ ] get_subagent_messages() signature changed to use event IDs\n- [ ] Removed: parse_log_messages, LogParseResult, get_position_for_timestamp\n- [ ] All callers updated to unpack tuple\n- [ ] Message filtering logic preserved","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-07T08:08:27.096758Z","updated_at":"2025-11-07T09:44:51.65392Z","closed_at":"2025-11-07T09:44:51.65392Z","dependencies":[{"issue_id":"hook-comms-5qc","depends_on_id":"hook-comms-tpn","type":"parent-child","created_at":"2025-11-07T08:12:41.143982Z","created_by":"daemon"},{"issue_id":"hook-comms-5qc","depends_on_id":"hook-comms-8up","type":"blocks","created_at":"2025-11-07T08:12:53.782013Z","created_by":"daemon"}]}
{"id":"hook-comms-6zj","content_hash":"b5ad13282b0af9d5e68e71476b0bd7c89772c19007efd53f0090ab7ce1ef1202","title":"Phase 5: Update lifecycle commands in lifecycle.py","description":"Remove instances_dir creation, update file existence checks to use DB queries. See docs/plans/instance-db-migration.md Phase 5 (lines 1026-1062).","design":"cmd_launch(): remove instances_dir creation, just call init_db(). Replace instance_dir.exists() checks with SELECT COUNT(*) FROM instances.","acceptance_criteria":"- [ ] instances_dir creation removed from cmd_launch()\n- [ ] File existence checks replaced with DB queries\n- [ ] No INSTANCES_DIR references remain","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-08T06:43:33.532756Z","updated_at":"2025-11-08T06:43:33.532756Z","dependencies":[{"issue_id":"hook-comms-6zj","depends_on_id":"hook-comms-87f","type":"parent-child","created_at":"2025-11-08T06:47:07.738934Z","created_by":"daemon"}]}
{"id":"hook-comms-87f","content_hash":"da650af1c93db96c4610f2e6addd227bfa894d84feff6681bce61c723151fa0d","title":"Migrate instance storage from JSON files to SQLite","description":"Move all instance state from ~/.hcom/instances/*.json files to SQLite database. Clean cutover, no migration, no backwards compatibility. See docs/plans/instance-db-migration.md for complete plan (6 review rounds, implementation-ready).","design":"Single instances table with JSON columns for complex fields (current_subagents, subagent_mappings). UPSERT pattern for atomicity. NULL for vanilla instances (session_id). Name prefix queries for cleanup (FK won't work for vanilla). Breaking API changes acceptable for alpha software.","acceptance_criteria":"- [ ] All instance data stored in SQLite (no JSON files)\n- [ ] INSTANCES_DIR constant deleted\n- [ ] All tests passing with DB-native operations\n- [ ] NULL session_id allows multiple vanilla instances\n- [ ] Name generation race-safe (retry on collision)\n- [ ] Subagent cleanup works for vanilla + HCOM instances\n- [ ] Boolean→integer conversion explicit\n- [ ] init_hook_context fills all required fields\n- [ ] notify_instance uses notify_port + newline ping","status":"open","priority":0,"issue_type":"epic","created_at":"2025-11-08T06:42:16.098018Z","updated_at":"2025-11-08T06:42:16.098018Z"}
{"id":"hook-comms-8up","content_hash":"1d5a9c6ce396d33494cd57a33ac6b50b44e852498c71d3abae0d3ae6013ae6c9","title":"Phase 4: Update Hook Handlers","description":"Update all hook handlers in src/hcom/hooks/handlers.py to use event IDs instead of byte positions. Critical functions: _deliver_task_freeze_messages(), _handle_task_completion(), _run_subagent_done_polling(), _run_stop_polling_loop().","design":"_deliver_task_freeze_messages(): Query get_events_since(parent_event_id), filter subagent/parent messages, return dict with last_event_id. _handle_task_completion(): Get parent_event_id from instance data, call _deliver_task_freeze_messages(), update_instance_position with last_event_id. _run_subagent_done_polling(): Call get_unread_messages(update_position=False), update to max_event_id. _run_stop_polling_loop(): Call get_unread_messages(update_position=True), unpack tuple.","acceptance_criteria":"- [ ] _deliver_task_freeze_messages uses event IDs\n- [ ] _handle_task_completion updates last_event_id atomically\n- [ ] _run_subagent_done_polling polls by event ID\n- [ ] _run_stop_polling_loop unpacks tuple correctly\n- [ ] All position tracking uses last_event_id not pos","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-07T08:09:00.978579Z","updated_at":"2025-11-07T09:44:51.788863Z","closed_at":"2025-11-07T09:44:51.788863Z","dependencies":[{"issue_id":"hook-comms-8up","depends_on_id":"hook-comms-tpn","type":"parent-child","created_at":"2025-11-07T08:12:41.285427Z","created_by":"daemon"},{"issue_id":"hook-comms-8up","depends_on_id":"hook-comms-tby","type":"blocks","created_at":"2025-11-07T08:12:53.947879Z","created_by":"daemon"},{"issue_id":"hook-comms-8up","depends_on_id":"hook-comms-dj9","type":"blocks","created_at":"2025-11-07T08:12:54.029361Z","created_by":"daemon"}]}
{"id":"hook-comms-8z7","content_hash":"418a86252c652b048786c42b36752af487b5d6b786ceda5311b232344cd70aa2","title":"Phase 9: Update test suite for DB migration","description":"Delete JSON-dependent tests, add DB-native tests. See docs/plans/instance-db-migration.md Phase 9 (lines 1234-1530).","design":"DELETE: TestPositionFiles, make_instance fixture, test_path_traversal, test_background_file_creation, test_archive_exports, test_cleanup_archived_json, test_orphan_cleanup. ADD: test_vanilla_instances_null_session_id, test_upsert_behavior, test_json_column_operations, test_db_error_handling, test_concurrent_name_generation, test_foreign_key_cascades, test_generator_apis.","acceptance_criteria":"- [ ] All JSON-dependent tests deleted\n- [ ] DB-native tests added\n- [ ] NULL session_id tests pass\n- [ ] Race condition tests pass\n- [ ] JSON column validation tests pass\n- [ ] All tests using get_instance_file() updated\n- [ ] test suite passes completely","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-08T06:43:51.680577Z","updated_at":"2025-11-08T06:43:51.680577Z","dependencies":[{"issue_id":"hook-comms-8z7","depends_on_id":"hook-comms-87f","type":"parent-child","created_at":"2025-11-08T06:47:08.364792Z","created_by":"daemon"}]}
{"id":"hook-comms-9z7","content_hash":"795a38016e1a5b414afa0beaffe333c1a25ade9fc9df88a813f0e07b858d25f2","title":"Phase 1: Extend database schema in db.py","description":"Add PRAGMA foreign_keys, create instances table with JSON columns, add indexes. See docs/plans/instance-db-migration.md Phase 1 (lines 161-458).","design":"Add to init_db(): instances table (name PK, session_id UNIQUE nullable, parent_session_id FK, JSON columns with CHECK constraints). Add get_instance(), save_instance(), iter_instances() helpers. Enable FK with PRAGMA foreign_keys = ON in get_db().","acceptance_criteria":"- [ ] PRAGMA foreign_keys = ON in get_db()\n- [ ] instances table created with all fields from plan\n- [ ] JSON columns have CHECK(json_valid()) constraints\n- [ ] Indexes created (session_id, parent_session_id, tag, enabled, status)\n- [ ] save_instance() uses UPSERT pattern\n- [ ] iter_instances() yields deserialized dicts","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-08T06:43:15.422502Z","updated_at":"2025-11-08T07:36:00.52002Z","dependencies":[{"issue_id":"hook-comms-9z7","depends_on_id":"hook-comms-mjn","type":"blocks","created_at":"2025-11-08T06:46:56.449203Z","created_by":"daemon"},{"issue_id":"hook-comms-9z7","depends_on_id":"hook-comms-87f","type":"parent-child","created_at":"2025-11-08T06:47:07.139091Z","created_by":"daemon"}]}
{"id":"hook-comms-co6","content_hash":"e9e70178685e7b3c7b5310e14d281fd1b046b4fed1bc4641851c6bc3200f438d","title":"Update documentation for SQLite changes","description":"Update ARCHITECTURE.md, README.md, CLAUDE.md for SQLite backend. File layout section, message format, position tracking, performance metrics all need updates.","acceptance_criteria":"- [ ] ARCHITECTURE.md updated (File Layout section lines 703-759, Position tracking line 474, Performance section line 813)\n- [ ] README.md command examples updated\n- [ ] CLAUDE.md testing commands updated\n- [ ] Bootstrap text in runtime.py updated","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-07T08:15:13.408011Z","updated_at":"2025-11-07T08:15:13.408011Z"}
{"id":"hook-comms-dj9","content_hash":"a9edb666d13fa7a9bc50f1f162e255744dd095755a5c599a40fddf74f97cac17","title":"Phase 6: Update Test Suite","description":"Update all tests to use SQLite instead of file-based log. 313 test functions across 5 test files need updating. Critical: test_unit.py message tests, hook handler tests, integration tests.","design":"Update test_send_message(): Verify in events table not file. Update test_get_unread_messages(): Unpack tuple, verify event_id. Update all pos field references to last_event_id. Add new tests: test_event_logging(), test_query_filtering(), test_concurrent_writes(). Integration tests likely need complete rewrite.","acceptance_criteria":"- [ ] All message tests updated for SQLite\n- [ ] Hook handler tests use event IDs\n- [ ] Integration tests pass with new backend\n- [ ] New tests added for event logging\n- [ ] All pos field references updated to last_event_id\n- [ ] Test coverage maintained at current level","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-07T08:11:25.468096Z","updated_at":"2025-11-07T08:11:25.468096Z","dependencies":[{"issue_id":"hook-comms-dj9","depends_on_id":"hook-comms-tpn","type":"parent-child","created_at":"2025-11-07T08:12:41.420138Z","created_by":"daemon"},{"issue_id":"hook-comms-dj9","depends_on_id":"hook-comms-jkx","type":"blocks","created_at":"2025-11-07T08:12:54.18732Z","created_by":"daemon"}],"comments":[{"id":1,"issue_id":"hook-comms-dj9","author":"anno","text":"Test Coverage Audit Complete\n\nAudited all 313 tests across 5 files. Key findings:\n\n**Impact Summary:**\n- 15 tests need changes (5% of total)\n- 298 tests unchanged (95% - excellent!)\n- 19 new tests recommended\n\n**By File:**\n- test_unit.py: 14 tests need updates (message/log operations)\n- test-int.py: 1 test needs update (pos field validation)\n- test_validation.py: 0 changes (config validation only)\n- test_claude_args.py: 0 changes (arg parsing only)\n- test_functions.py: 0 changes (utility functions)\n\n**Key Changes Required:**\n1. Replace parse_log_messages() → get_events_since()/query_events()\n2. Replace LogParseResult → direct dict access\n3. Replace 'pos' field → 'last_event_id' field (16+ occurrences)\n4. Update file-based log tests → SQLite WAL tests\n5. Add 19 new SQLite-specific tests\n\n**Implementation Order:**\n1. Add new SQLite tests (db operations, WAL, events)\n2. Update test_unit.py (parse_log, position tracking, concurrency)\n3. Update test-int.py (validation checks)\n4. Full suite verification\n\nFull audit document: temp/sqlite-test-audit.md\n\nThe low impact percentage (5%) validates the clean abstraction in the migration design.","created_at":"2025-11-07T08:36:21Z"}]}
{"id":"hook-comms-dyb","content_hash":"c0ede711f189c17cf4c0b18747eeeb402c3687ba2492c956a75911a9a271cd7f","title":"Phase 7: Fix utilities (utils.py, runtime.py)","description":"Fix init_hook_context to fill all required fields. Fix notify_instance to use notify_port + newline. See docs/plans/instance-db-migration.md Phase 7 (lines 1072-1165).","design":"init_hook_context() must fill directory, tag, session_id, background fields (not just transcript_path) - dispatcher contract requirement. notify_instance() uses notify_port (not tcp_port) and sends b'\\n' (not b'NOTIFY').","acceptance_criteria":"- [ ] init_hook_context fills directory, tag, session_id, background\n- [ ] notify_instance uses notify_port field\n- [ ] notify_instance sends b'\\n' ping\n- [ ] Dispatcher contract maintained","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-08T06:43:42.607003Z","updated_at":"2025-11-08T06:43:42.607003Z","dependencies":[{"issue_id":"hook-comms-dyb","depends_on_id":"hook-comms-2rh","type":"blocks","created_at":"2025-11-08T06:46:57.19927Z","created_by":"daemon"},{"issue_id":"hook-comms-dyb","depends_on_id":"hook-comms-87f","type":"parent-child","created_at":"2025-11-08T06:47:08.046146Z","created_by":"daemon"}]}
{"id":"hook-comms-iqf","content_hash":"97e6cc8400edcf2d7090785eec1a8e9ff28236c9050aef9c719041c71223584d","title":"Test coverage audit for SQLite migration","description":"Plan shows example tests but 313 test functions need updating. Need comprehensive audit of which tests require changes and what new tests to add.","design":"Audit all test files: test_unit.py (73 tests), test-int.py (26 tests), test_validation.py (53 tests), test_claude_args.py (139 tests), test_functions.py (22 tests). Identify: tests using parse_log_messages(), tests checking pos field, tests using LogParseResult, integration tests with message flows. Create checklist of required changes per file.","acceptance_criteria":"- [ ] Complete audit of all 5 test files documented\n- [ ] List of tests requiring changes created\n- [ ] New test requirements identified\n- [ ] Checklist added to Phase 6 issue","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T08:13:18.21773Z","updated_at":"2025-11-07T08:36:44.00072Z","closed_at":"2025-11-07T08:36:44.00072Z","dependencies":[{"issue_id":"hook-comms-iqf","depends_on_id":"hook-comms-dj9","type":"related","created_at":"2025-11-07T08:15:07.127504Z","created_by":"daemon"}]}
{"id":"hook-comms-jkx","content_hash":"3c775e5b95769066f3b3238baf98268cf9b8374d9c6537ccf5313ad660ee4670","title":"Phase 7: Update TUI Dashboard","description":"Update ui/ package to use event IDs instead of file size polling. Changes in src/hcom/ui/types.py, tui.py. MANAGE mode message preview, LOG mode initial render, LOG mode streaming all need refactoring.","design":"UIState dataclass: Replace last_log_size with last_event_id. MANAGE mode: Call get_last_event_id() for change detection, query get_events_since(0, event_type='message') for preview. LOG mode initial: Query all message events, render each. LOG mode streaming: Poll get_last_event_id(), query new events since last_event_id, render incrementally.","acceptance_criteria":"- [ ] UIState uses last_event_id not last_log_size\n- [ ] MANAGE mode polls event ID for changes\n- [ ] LOG mode initial render queries all messages\n- [ ] LOG mode streaming polls and renders new events\n- [ ] TUI change detection works correctly\n- [ ] No file size polling remains","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-07T08:12:04.8567Z","updated_at":"2025-11-07T15:44:19.336676Z","closed_at":"2025-11-07T15:44:19.336721Z","dependencies":[{"issue_id":"hook-comms-jkx","depends_on_id":"hook-comms-tpn","type":"parent-child","created_at":"2025-11-07T08:12:41.490514Z","created_by":"daemon"},{"issue_id":"hook-comms-jkx","depends_on_id":"hook-comms-co6","type":"blocks","created_at":"2025-11-07T08:15:25.240143Z","created_by":"daemon"}]}
{"id":"hook-comms-l94","content_hash":"13528be610c941f59d9efc8ebe947c408dea49c824af673c8f4d0d6f53057a0b","title":"Test issue direct mode","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-08T05:29:34.950285Z","updated_at":"2025-11-08T05:29:34.950285Z"}
{"id":"hook-comms-mjn","content_hash":"dcfb16d7b6f22eb667bb90c9718327a32a9b4af8caa475f3056b73acd6f54ba4","title":"Phase 2: Replace instance I/O in instances.py","description":"Rewrite load/save/update functions to use DB instead of JSON files. Add race-safe name generation. See docs/plans/instance-db-migration.md Phase 2 (lines 496-847).","design":"Delete get_instance_file(), load_instance_position(), old save_instance_position(), load_all_positions(). Replace with DB queries. Add resolve_instance_name() with retry loop for race conditions. get_display_name() checks DB for collisions. save_instance_position() keeps UPSERT + bool→int conversion.","acceptance_criteria":"- [ ] All file I/O functions deleted\n- [ ] DB query wrappers implemented\n- [ ] resolve_instance_name() retries on collision (max 100)\n- [ ] get_display_name() queries DB (not filesystem)\n- [ ] save_instance_position() converts bool→int\n- [ ] NULL used for vanilla session_id (not empty string)\n- [ ] hooks/utils.py:157 caller still works (uses full dict)","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-08T06:43:19.999689Z","updated_at":"2025-11-08T06:43:19.999689Z","dependencies":[{"issue_id":"hook-comms-mjn","depends_on_id":"hook-comms-3tk","type":"blocks","created_at":"2025-11-08T06:46:56.598055Z","created_by":"daemon"},{"issue_id":"hook-comms-mjn","depends_on_id":"hook-comms-dyb","type":"blocks","created_at":"2025-11-08T06:46:56.741908Z","created_by":"daemon"},{"issue_id":"hook-comms-mjn","depends_on_id":"hook-comms-87f","type":"parent-child","created_at":"2025-11-08T06:47:07.293773Z","created_by":"daemon"}]}
{"id":"hook-comms-ocx","content_hash":"1049ecdc44d86b61409acc6dbd68ddab1579b018e2b46eb7d1b6f0fca80a5e70","title":"Phase 1: Core SQLite Infrastructure (db.py)","description":"Create new src/hcom/core/db.py module (~200 lines) with SQLite interface. Provides foundation for all other phases.","design":"Module-level connection cache (_db_conn singleton). Functions: get_db() for cached connection, init_db() for schema creation (idempotent), close_db() for cleanup, log_event() to insert events, get_events_since() for position tracking, query_events() for time-based snapshots, get_last_event_id() for current max. Schema with indexes on timestamp, type, instance, type+instance composite. WAL mode with journal_mode=WAL, wal_autocheckpoint=1000, busy_timeout=5000.","acceptance_criteria":"- [ ] db.py module created with all functions\n- [ ] SQLite schema creates successfully with indexes\n- [ ] WAL mode configured correctly\n- [ ] get_db() returns cached connection\n- [ ] log_event() inserts and returns event ID\n- [ ] get_events_since() queries by ID with filters\n- [ ] Import succeeds without errors","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-07T08:07:39.451877Z","updated_at":"2025-11-07T09:44:51.585268Z","closed_at":"2025-11-07T09:44:51.585268Z","dependencies":[{"issue_id":"hook-comms-ocx","depends_on_id":"hook-comms-tpn","type":"parent-child","created_at":"2025-11-07T08:12:41.072775Z","created_by":"daemon"},{"issue_id":"hook-comms-ocx","depends_on_id":"hook-comms-5qc","type":"blocks","created_at":"2025-11-07T08:12:53.627142Z","created_by":"daemon"},{"issue_id":"hook-comms-ocx","depends_on_id":"hook-comms-sm9","type":"blocks","created_at":"2025-11-07T08:12:53.702785Z","created_by":"daemon"}]}
{"id":"hook-comms-sm9","content_hash":"c5ad98ddb1416d034bb28aa2f4011f0545e84a038623e7b1cf273398022bf508","title":"Phase 3: Update Instance Management","description":"Add status event logging to src/hcom/core/instances.py. Update set_status() to log events, initialize_instance_in_position_file() to use last_event_id instead of pos field.","design":"set_status(): After updating instance file, log_event('status', instance, {from, to, context}) in try/except (best-effort, non-blocking). initialize_instance_in_position_file(): Replace pos field with last_event_id, use get_last_event_id() for SKIP_HISTORY instead of get_position_for_timestamp().","acceptance_criteria":"- [ ] set_status() logs status change events (best-effort)\n- [ ] initialize_instance_in_position_file() uses last_event_id field\n- [ ] SKIP_HISTORY uses get_last_event_id() not file size\n- [ ] Existing pos field references removed from defaults","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-07T08:08:44.651806Z","updated_at":"2025-11-07T09:44:51.722691Z","closed_at":"2025-11-07T09:44:51.722691Z","dependencies":[{"issue_id":"hook-comms-sm9","depends_on_id":"hook-comms-tpn","type":"parent-child","created_at":"2025-11-07T08:12:41.214148Z","created_by":"daemon"},{"issue_id":"hook-comms-sm9","depends_on_id":"hook-comms-8up","type":"blocks","created_at":"2025-11-07T08:12:53.863349Z","created_by":"daemon"}]}
{"id":"hook-comms-tby","content_hash":"ab1608a7c3afb90379dba544968a68a793b59239f3651b99d70cd2071023926d","title":"Phase 5: Update CLI Commands","description":"Replace cmd_watch() in src/hcom/commands/admin.py with new query interface. Add cmd_list() for instance status. Update clear() to handle SQLite files. Major UX change: hcom watch goes from interactive TUI to JSON snapshot output.","design":"cmd_watch(): Parse --type, --instance, --last N, --wait SEC flags. Wait mode: poll database until matching event appears (exit 0) or timeout (exit 1). Snapshot mode (default): SELECT * FROM events with filters, ORDER BY id DESC LIMIT N, print JSON per line. cmd_list(): Query load_all_positions(), print instance status as JSON or human-readable. clear(): Checkpoint WAL (PRAGMA wal_checkpoint(TRUNCATE)), close_db(), rename events.db to archive, delete WAL/SHM files.","acceptance_criteria":"- [ ] cmd_watch() returns JSON snapshots not TUI\n- [ ] cmd_watch --wait blocks until matching event\n- [ ] cmd_list shows instance status\n- [ ] clear() checkpoints and archives SQLite files\n- [ ] Breaking change: old flags removed (--logs, --status, --launch)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-07T08:10:18.952266Z","updated_at":"2025-11-07T15:31:22.587954Z","closed_at":"2025-11-07T15:31:22.587988Z","dependencies":[{"issue_id":"hook-comms-tby","depends_on_id":"hook-comms-tpn","type":"parent-child","created_at":"2025-11-07T08:12:41.353646Z","created_by":"daemon"},{"issue_id":"hook-comms-tby","depends_on_id":"hook-comms-jkx","type":"blocks","created_at":"2025-11-07T08:12:54.110476Z","created_by":"daemon"}]}
{"id":"hook-comms-tpn","content_hash":"0fe949d7277adc229bb0e32dc16f8afd001a80b9e3c37944f0942d307937cdcf","title":"SQLite Events System Migration","description":"Replace file-based message log (hcom.log) and scattered event tracking with unified SQLite database for all events. Primary use case: Claude Code orchestrators querying event snapshots to monitor and coordinate hcom instances. Migration strategy: clean swap, no backwards compatibility (alpha state, breaking changes acceptable).","design":"Use SQLite with WAL mode for concurrent reads/writes. Schema: events table with (id, timestamp, type, instance, data JSON). Event types: message, status. Position tracking changes from byte offset (pos) to event ID (last_event_id). Benefits: snapshot queries, single source of truth, integer ID position tracking, SQL filtering, atomic operations.","status":"open","priority":0,"issue_type":"epic","created_at":"2025-11-07T08:07:11.512226Z","updated_at":"2025-11-07T08:07:11.512226Z"}
{"id":"hook-comms-v0m","content_hash":"061f1eec324d068966d6f9120c0ce901812911d62bcc9302e7e906bd024f9975","title":"Phase 4: Update CLI commands in admin.py","description":"Update clear() to archive DB only (no JSON export). Use DB queries for instance checks. See docs/plans/instance-db-migration.md Phase 4 (lines 890-1064).","design":"clear() archives hcom.db with checkpoint. clear_all_positions() becomes DELETE FROM instances. iter_instance_directories() reads archived DB files for cleanup --all. No JSON file operations.","acceptance_criteria":"- [ ] clear() checkpoints and archives DB only\n- [ ] clear_all_positions() uses DELETE FROM instances\n- [ ] iter_instance_directories() queries archived DBs\n- [ ] No JSON file archiving/cleanup code remains\n- [ ] DB-only archives work with cleanup --all","status":"open","priority":0,"issue_type":"task","created_at":"2025-11-08T06:43:28.974775Z","updated_at":"2025-11-08T06:43:28.974775Z","dependencies":[{"issue_id":"hook-comms-v0m","depends_on_id":"hook-comms-6zj","type":"blocks","created_at":"2025-11-08T06:46:57.048186Z","created_by":"daemon"},{"issue_id":"hook-comms-v0m","depends_on_id":"hook-comms-87f","type":"parent-child","created_at":"2025-11-08T06:47:07.592958Z","created_by":"daemon"}]}
